!function(a){"use strict";a.module("nb.acl",["nb.auth"]).directive("nbAclIfAllowed",["ngIfDirective","$acl",function(a,b){var c=a[0];return{transclude:c.transclude,priority:c.priority,terminal:c.terminal,restrict:c.restrict,link:function(a,d,e,f,g){e.ngIf=function(){return b.isAllowed(e.nbAclIfAllowed)},c.link.call(c,a,d,e,f,g)}}}]).directive("nbAclShowAllowed",["$acl","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){a.isAllowed(e.nbAclShowAllowed)?d.removeClass("acl-hide"):d.addClass("acl-hide"),b.$on("$acl.update.rights",function(){a.isAllowed(e.nbAclShowAllowed)?d.removeClass("acl-hide"):d.addClass("acl-hide")}),b.$on("$acl.update.groups",function(){a.isAllowed(e.nbAclShowAllowed)?d.removeClass("acl-hide"):d.addClass("acl-hide")})}}}]).directive("nbAclIfGroup",["ngIfDirective","$acl",function(a,b){var c=a[0];return{transclude:c.transclude,priority:c.priority,terminal:c.terminal,restrict:c.restrict,link:function(a,d,e,f,g){e.ngIf=function(){return b.isGroup(e.nbAclIfGroup)},c.link.call(c,a,d,e,f,g)}}}]).directive("nbAclShowGroup",["$acl","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){a.isGroup(e.nbAclShowGroup)?d.removeClass("acl-hide"):d.addClass("acl-hide"),b.$on("$acl.update.groups",function(){a.isGroup(e.nbAclShowGroup)?d.removeClass("acl-hide"):d.addClass("acl-hide")})}}}]).provider("$acl",[function(){var b,c=this;c.$get=["$rootScope","$localStorage","$state","$auth",function(c,d,e,f){return d.aclRights||(d.aclRights=[]),d.aclGroups||(d.aclGroups=[]),b=function(a){return a?b.isAllowed(a):b.rights()},b.isAllowed=function(c){var d=b.rights(),e=[];a.isArray(c)?e=c:a.isString(c)&&(e=c.split("|"));var f=!1;return a.forEach(e,function(a){!f&&d.indexOf(a)>-1&&(f=!0)}),f},b.isGroup=function(c){var d=b.groups(),e=[],f=!1;return a.isArray(c)?e=c:a.isString(c)&&(e=c.split("|")),a.forEach(e,function(a){if(!f){var c=a,e=[];a.indexOf(":")>-1&&(c=a.substr(0,a.indexOf(":")),e=a.substr(a.indexOf(":")+1)),d.indexOf(c)>-1&&(f=!e.length||b.isAllowed(e.replace(/;/gi,"|").replace(/,/gi,"|")))}}),f},b.rights=function(b){return b&&a.isArray(b)&&(d.aclRights=b||[],c.$emit("$acl.update.rights",d.aclRights)),d.aclRights||[]},b.groups=function(b){return b&&a.isArray(b)&&(d.aclGroups=b||[],c.$emit("$acl.update.groups",d.aclGroups)),d.aclGroups||[]},c.$on("$stateChangeStart",function(c,d,g){if(g.acl){var h=g.acl;if(a.isString(g.acl)&&(h=g.acl.split("|")),h.length&&!b.isAllowed(h)){c.preventDefault();var i=f.getStateMain();e.go(i.name,i.params,i.options)}}}),b}]}])}(angular);