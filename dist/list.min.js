!function(a){"use strict";var b=function(b,c,d,e,f){var g=this;c.addClass("nb-list");var h={common:function(a){b.$count=b.$rows.length,b.$total=a,b.$more=b.$count<b.$total,b.$pages=Math.ceil(b.$total/e.limit()),b.$pageMin=1,b.$pageMax=b.$pages,b.$prev=b.$page>b.$pageMin,b.$next=b.$page<b.$pageMax;var c=b.$page-1;c<1&&(c=1);var d=b.$page+1;d>b.$pages&&(d=b.$pages),b.$prevPage=isNaN(c)?1:c,b.$nextPage=isNaN(d)?1:d,b.$pagination=b.$pages>1;for(var f=[],g=e.range(),h=[],i=b.$pageMin,j=b.$pageMax,k=1;k<=b.$pages;k++)f.push(k);b.$paginator=f,g>0&&(i=b.$page-g,i<b.$pageMin&&(i=b.$pageMin),j=b.$page+g,j>b.$pageMax&&(j=b.$pageMax));for(var k=i;k<=j;k++)h.push(k);b.$range=h,b.$pageMinInRange=b.$range.indexOf(b.$pageMin)>-1,b.$pageMaxInRange=b.$range.indexOf(b.$pageMax)>-1},init:function(c,d){var e=[];a.forEach(c,function(a){e.push(a)}),b.$rows=e,b.$page=1,h.common(d),b.$init=!0},more:function(d,e){var f=c.parents("md-content"),i=c.height();b.$page>b.$pageMin&&(b.$rows=[]),a.forEach(d,function(a){b.$rows.push(a)}),b.$page=b.$pageMin,h.common(e),g.$timeout(function(){f.first().animate({scrollTop:i-f.offset().top},500)},10)},page:function(c,d,e){var f=[];a.forEach(d,function(a){f.push(a)}),b.$rows=f,b.$page=c+1,h.common(e)}};f(b,function(a){c.prepend(a)}),b.$offset=e.offset(),b.$limit=e.limit(),b.$loading=!0,b.$init=!1,b.$rows=[],b.$paginator=[],h.common(0),b.$nbList={load:function(c){if(a.isArray(b.source))h.init(b.source,b.source.length),b.$loading=!1;else if(a.isFunction(b.source)){b.$loading=!0;var d=b.source({offset:c?0:e.offset(),limit:c||e.limit()});a.isArray(d)?(h.init(d,d.length),b.$loading=!1):d.then(function(a){h.init(e.mapRows(a.data),e.mapTotal(a.data))},function(a){console.log(a.message)})["finally"](function(){b.$loading=!1})}},refresh:function(){b.$page>1?this.page(b.$page):this.load(b.$count)},reset:function(){b.offset=0,b.offset=0,b.$nbList.load()},more:function(){b.$loading=!0;var c=e.offset()+e.limit();b.$page>b.$pageMin&&(c=0);var d=b.source({offset:c,limit:e.limit()});b.offset=c,b.offset=c,a.isArray(d)?(h.more(d,d.length),b.$loading=!1):d.then(function(a){h.more(e.mapRows(a.data),e.mapTotal(a.data))},function(a){console.log(a.message)})["finally"](function(){b.$loading=!1})},page:function(c){b.$loading=!0;var d=c-1;d<0?d=0:d>=b.$pages&&(d=b.pages-1);var f=d*e.limit(),g=b.source({offset:f,limit:e.limit()});b.offset=f,b.offset=f,a.isArray(g)?(h.page(d,g,g.length),b.$loading=!1):g.then(function(a){h.page(d,e.mapRows(a.data),e.mapTotal(a.data))},function(a){console.log(a.message)})["finally"](function(){b.$loading=!1})}},b.$nbList.load()};a.module("nb.list",[]).provider("$nbList",[function(){var a=this,b={limit:10,range:0,paginationTemplate:"",map:{rows:function(a){return a.rows},total:function(a){return a.total}}};a.limit=function(a){return b.limit=a,b.limit},a.range=function(a){return b.range=a,b.range},a.paginationTemplate=function(a){return b.paginationTemplate=a,b.paginationTemplate},a.mapRows=function(a){return b.map.rows=a,b.map.rows},a.mapTotal=function(a){return b.map.total=a,b.map.total},a.$get=[function(){var a=function(){};return a.limit=function(){return b.limit},a.range=function(){return b.range},a.paginationTemplate=function(){return b.paginationTemplate},a.mapRows=function(a){return b.map.rows.call(this,a)},a.mapTotal=function(a){return b.map.total.call(this,a)},a}]}]).directive("nbList",["$nbList","$compile","$templateCache","$q","$http","$timeout","$document","$window",function(a,c,d,e,f,g,h,i){return{restrict:"EA",transclude:!0,scope:{source:"=",offset:"@",limit:"@",range:"@",locals:"=",paginationTemplate:"@",$nbList:"=control"},controller:["$scope",function(b){var c=this;c.offset=function(){return 1*(b.offset||0)},c.limit=function(){return 1*(b.limit||a.limit())},c.range=function(){return 1*(b.range||a.range())},c.paginationTemplate=function(){return b.paginationTemplate||a.paginationTemplate()},c.mapRows=function(b){return a.mapRows(b)},c.mapTotal=function(b){return a.mapTotal(b)}}],link:function(a,j,k,l){var m=e.defer(),n=l.paginationTemplate(),o=arguments;if(m.promise.then(function(d){if(""!=d){var e=c(d)(a);j.append(e)}b.apply({$timeout:g,$document:h,$window:i},o)}),void 0!=n&&""!=n){var p=d.get(n);void 0!=p&&""!=p?m.resolve(p):f.get(n).then(function(a){m.resolve(a.data)},function(){m.resolve("")})}else m.resolve("")}}}]).directive("nbListScroll",["$window",function(a){return{restrict:"A",require:"nbList",priority:1,link:function(a,b,c){b.addClass("nb-list-scroll")}}}]).directive("nbListRow",[function(){return{restrict:"EA",link:function(a,b){b.addClass("nb-list-row")}}}]).directive("nbListCell",[function(){return{restrict:"EA",link:function(a,b){b.addClass("nb-list-cell")}}}])}(angular);