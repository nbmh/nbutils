!function(t){"use strict";var n=function(n,a,i,e,o){var r=this;a.addClass("nb-list");var s={common:function(t){n.$count=n.$rows.length,n.$total=t,n.$more=n.$count<n.$total,n.$pages=Math.ceil(n.$total/e.limit()),n.$pageMin=1,n.$pageMax=n.$pages,n.$prev=n.$page>n.$pageMin,n.$next=n.$page<n.$pageMax;var a=n.$page-1;a<1&&(a=1);var i=n.$page+1;i>n.$pages&&(i=n.$pages),n.$prevPage=isNaN(a)?1:a,n.$nextPage=isNaN(i)?1:i,n.$pagination=n.$pages>1;for(var o=[],r=e.range(),s=[],l=n.$pageMin,u=n.$pageMax,p=1;p<=n.$pages;p++)o.push(p);n.$paginator=o,r>0&&((l=n.$page-r)<n.$pageMin&&(l=n.$pageMin),(u=n.$page+r)>n.$pageMax&&(u=n.$pageMax));for(p=l;p<=u;p++)s.push(p);n.$range=s,n.$pageMinInRange=n.$range.indexOf(n.$pageMin)>-1,n.$pageMaxInRange=n.$range.indexOf(n.$pageMax)>-1},init:function(a,i){var e=[];t.forEach(a,function(t){e.push(t)}),n.$rows=e,n.$page=1,s.common(i),n.$init=!0},more:function(i,e){var o=a.parents("md-content"),l=a.height();n.$page>n.$pageMin&&(n.$rows=[]),t.forEach(i,function(t){n.$rows.push(t)}),n.$page=n.$pageMin,s.common(e),r.$timeout(function(){o.first().animate({scrollTop:l-o.offset().top},500)},10)},page:function(a,i,e){var o=[];t.forEach(i,function(t){o.push(t)}),n.$rows=o,n.$page=a+1,s.common(e)}};o(n,function(t){a.prepend(t)}),n.$offset=e.offset(),n.$limit=e.limit(),n.$loading=!0,n.$init=!1,n.$rows=[],n.$paginator=[],s.common(0),n.$nbList={load:function(a){if(t.isArray(n.source))s.init(n.source,n.source.length),n.$loading=!1;else if(t.isFunction(n.source)){n.$loading=!0;var i=n.source({offset:a?0:e.offset(),limit:a||e.limit()});t.isArray(i)?(s.init(i,i.length),n.$loading=!1):i&&i.then(function(t){s.init(e.mapRows(t.data),e.mapTotal(t.data))},function(t){console.log(t.status+" - "+t.statusText),s.init([],0)}).finally(function(){n.$loading=!1})}},refresh:function(){n.$page>1?this.page(n.$page):this.load(n.$count)},reset:function(){n.offset=0,n.offset=0,n.$nbList.load()},clear:function(){s.init([],0)},more:function(){n.$loading=!0;var a=e.offset()+e.limit();n.$page>n.$pageMin&&(a=0);var i=n.source({offset:a,limit:e.limit()});n.offset=a,n.offset=a,t.isArray(i)?(s.more(i,i.length),n.$loading=!1):i.then(function(t){s.more(e.mapRows(t.data),e.mapTotal(t.data))},function(t){console.log(t.status+" - "+t.statusText),s.more([],0)}).finally(function(){n.$loading=!1})},page:function(a){n.$loading=!0;var i=a-1;i<0?i=0:i>=n.$pages&&(i=n.pages-1);var o=i*e.limit(),r=n.source({offset:o,limit:e.limit()});n.offset=o,n.offset=o,t.isArray(r)?(s.page(i,r,r.length),n.$loading=!1):r.then(function(t){s.page(i,e.mapRows(t.data),e.mapTotal(t.data))},function(t){console.log(t.status+" - "+t.statusText),s.page(i,[],0)}).finally(function(){n.$loading=!1})}},!0===n.autostart&&n.$nbList.load()};t.module("nb.list",[]).provider("$nbList",[function(){var t=this,n={limit:10,range:0,paginationTemplate:"",map:{rows:function(t){return t.rows},total:function(t){return t.total}}};t.limit=function(t){return n.limit=t,n.limit},t.range=function(t){return n.range=t,n.range},t.paginationTemplate=function(t){return n.paginationTemplate=t,n.paginationTemplate},t.mapRows=function(t){return n.map.rows=t,n.map.rows},t.mapTotal=function(t){return n.map.total=t,n.map.total},t.$get=[function(){var t=function(){};return t.limit=function(){return n.limit},t.range=function(){return n.range},t.paginationTemplate=function(){return n.paginationTemplate},t.mapRows=function(t){return n.map.rows.call(this,t)},t.mapTotal=function(t){return n.map.total.call(this,t)},t}]}]).directive("nbList",["$nbList","$compile","$templateCache","$q","$http","$timeout","$document","$window",function(t,a,i,e,o,r,s,l){return{restrict:"EA",transclude:!0,scope:{source:"=",offset:"@",limit:"@",range:"@",locals:"=",paginationTemplate:"@",$nbList:"=control",autostart:"@"},controller:["$scope",function(n){var a=this;a.offset=function(){return 1*(n.offset||0)},a.limit=function(){return 1*(n.limit||t.limit())},a.range=function(){return 1*(n.range||t.range())},a.paginationTemplate=function(){return n.paginationTemplate||t.paginationTemplate()},a.mapRows=function(n){return t.mapRows(n)},a.mapTotal=function(n){return t.mapTotal(n)}}],link:function(t,u,p,c){var f=e.defer(),g=c.paginationTemplate(),$=arguments;if(!1!==t.autostart&&(t.autostart=!0),f.promise.then(function(i){if(""!=i){var e=a(i)(t);u.append(e)}n.apply({$timeout:r,$document:s,$window:l},$)}),void 0!=g&&""!=g){var m=i.get(g);void 0!=m&&""!=m?f.resolve(m):o.get(g).then(function(t){f.resolve(t.data)},function(){f.resolve("")})}else f.resolve("")}}}]).directive("nbListScroll",["$window",function(t){return{restrict:"A",require:"nbList",priority:1,link:function(t,n,a){n.addClass("nb-list-scroll")}}}]).directive("nbListRow",[function(){return{restrict:"EA",link:function(t,n){n.addClass("nb-list-row")}}}]).directive("nbListCell",[function(){return{restrict:"EA",link:function(t,n){n.addClass("nb-list-cell")}}}])}(angular);