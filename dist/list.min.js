!function(n){"use strict";var t=function(t,i,a,e,o){var r=this;i.addClass("nb-list");var s={common:function(n){t.$count=t.$rows.length,t.$total=n,t.$more=t.$count<t.$total,t.$pages=Math.ceil(t.$total/e.limit()),t.$pageMin=1,t.$pageMax=t.$pages,t.$prev=t.$page>t.$pageMin,t.$next=t.$page<t.$pageMax;var i=t.$page-1;i<1&&(i=1);var a=t.$page+1;a>t.$pages&&(a=t.$pages),t.$prevPage=isNaN(i)?1:i,t.$nextPage=isNaN(a)?1:a,t.$pagination=t.$pages>1;for(var o=[],r=e.range(),s=[],l=t.$pageMin,u=t.$pageMax,p=1;p<=t.$pages;p++)o.push(p);t.$paginator=o,r>0&&((l=t.$page-r)<t.$pageMin&&(l=t.$pageMin),(u=t.$page+r)>t.$pageMax&&(u=t.$pageMax));for(p=l;p<=u;p++)s.push(p);t.$range=s,t.$pageMinInRange=t.$range.indexOf(t.$pageMin)>-1,t.$pageMaxInRange=t.$range.indexOf(t.$pageMax)>-1},init:function(i,a){var e=[];n.forEach(i,function(n){e.push(n)}),t.$rows=e,t.$page=1,s.common(a),t.$init=!0},more:function(a,e){var o=i.parents("md-content"),l=i.height();t.$page>t.$pageMin&&(t.$rows=[]),n.forEach(a,function(n){t.$rows.push(n)}),t.$page=t.$pageMin,s.common(e),r.$timeout(function(){o.first().animate({scrollTop:l-o.offset().top},500)},10)},page:function(i,a,e){var o=[];n.forEach(a,function(n){o.push(n)}),t.$rows=o,t.$page=i+1,s.common(e)}};o(t,function(n){i.prepend(n)}),t.$offset=e.offset(),t.$limit=e.limit(),t.$loading=!0,t.$init=!1,t.$rows=[],t.$paginator=[],s.common(0),t.$nbList={load:function(i){if(n.isArray(t.source))s.init(t.source,t.source.length),t.$loading=!1;else if(n.isFunction(t.source)){t.$loading=!0;var a=t.source({offset:i?0:e.offset(),limit:i||e.limit()});n.isArray(a)?(s.init(a,a.length),t.$loading=!1):a&&a.then(function(n){s.init(e.mapRows(n.data),e.mapTotal(n.data))},function(n){console.log(n.status+" - "+n.statusText),s.init([],0)}).finally(function(){t.$loading=!1})}},refresh:function(){t.$page>1?this.page(t.$page):this.load(t.$count)},reset:function(){t.offset=0,t.offset=0,t.$nbList.load()},clear:function(){s.init([],0)},more:function(){t.$loading=!0;var i=e.offset()+e.limit();t.$page>t.$pageMin&&(i=0);var a=t.source({offset:i,limit:e.limit()});t.offset=i,t.offset=i,n.isArray(a)?(s.more(a,a.length),t.$loading=!1):a.then(function(n){s.more(e.mapRows(n.data),e.mapTotal(n.data))},function(n){console.log(n.status+" - "+n.statusText),s.more([],0)}).finally(function(){t.$loading=!1})},page:function(i){t.$loading=!0;var a=i-1;a<0?a=0:a>=t.$pages&&(a=t.pages-1);var o=a*e.limit(),r=t.source({offset:o,limit:e.limit()});t.offset=o,t.offset=o,n.isArray(r)?(s.page(a,r,r.length),t.$loading=!1):r.then(function(n){s.page(a,e.mapRows(n.data),e.mapTotal(n.data))},function(n){console.log(n.status+" - "+n.statusText),s.page(a,[],0)}).finally(function(){t.$loading=!1})}},t.$nbList.load()};n.module("nb.list",[]).provider("$nbList",[function(){var n=this,t={limit:10,range:0,paginationTemplate:"",map:{rows:function(n){return n.rows},total:function(n){return n.total}}};n.limit=function(n){return t.limit=n,t.limit},n.range=function(n){return t.range=n,t.range},n.paginationTemplate=function(n){return t.paginationTemplate=n,t.paginationTemplate},n.mapRows=function(n){return t.map.rows=n,t.map.rows},n.mapTotal=function(n){return t.map.total=n,t.map.total},n.$get=[function(){var n=function(){};return n.limit=function(){return t.limit},n.range=function(){return t.range},n.paginationTemplate=function(){return t.paginationTemplate},n.mapRows=function(n){return t.map.rows.call(this,n)},n.mapTotal=function(n){return t.map.total.call(this,n)},n}]}]).directive("nbList",["$nbList","$compile","$templateCache","$q","$http","$timeout","$document","$window",function(n,i,a,e,o,r,s,l){return{restrict:"EA",transclude:!0,scope:{source:"=",offset:"@",limit:"@",range:"@",locals:"=",paginationTemplate:"@",$nbList:"=control"},controller:["$scope",function(t){var i=this;i.offset=function(){return 1*(t.offset||0)},i.limit=function(){return 1*(t.limit||n.limit())},i.range=function(){return 1*(t.range||n.range())},i.paginationTemplate=function(){return t.paginationTemplate||n.paginationTemplate()},i.mapRows=function(t){return n.mapRows(t)},i.mapTotal=function(t){return n.mapTotal(t)}}],link:function(n,u,p,c){var f=e.defer(),g=c.paginationTemplate(),$=arguments;if(f.promise.then(function(a){if(""!=a){var e=i(a)(n);u.append(e)}t.apply({$timeout:r,$document:s,$window:l},$)}),void 0!=g&&""!=g){var m=a.get(g);void 0!=m&&""!=m?f.resolve(m):o.get(g).then(function(n){f.resolve(n.data)},function(){f.resolve("")})}else f.resolve("")}}}]).directive("nbListScroll",["$window",function(n){return{restrict:"A",require:"nbList",priority:1,link:function(n,t,i){t.addClass("nb-list-scroll")}}}]).directive("nbListRow",[function(){return{restrict:"EA",link:function(n,t){t.addClass("nb-list-row")}}}]).directive("nbListCell",[function(){return{restrict:"EA",link:function(n,t){t.addClass("nb-list-cell")}}}])}(angular);